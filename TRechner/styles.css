/* ---------- Base ---------- */
*, *::before, *::after { box-sizing: border-box; }
html, body {
  height: 100%;
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  overflow: hidden; /* Prevent scrollbars from theme transitions */
}
body {
  background: var(--bg);
  color: var(--text);
  transition: background-color 0.4s ease, color 0.4s ease;
}

/* ===== Theme Variable Sets (unchanged from previous version) ===== */
/* Light Base */
html[data-theme^="light"] { --bg: #f7f7f9; --text: #1a1a1a; --muted: #4a4a4a; --glass-bg: rgba(255,255,255,0.65); --glass-border: rgba(0,0,0,0.08); --btn-bg: rgba(0,0,0,0.04); --btn-inset: rgba(255,255,255,0.7); --btn-shadow: rgba(0,0,0,0.18); --eq: #12b76a; --danger: #e53e3e; --shadow: 0 10px 30px rgba(0,0,0,0.08); }
html[data-theme="light"] { --accent: #3d6aff; --net-node: rgba(0,0,0,0.45); --net-link: rgba(100,120,180,0.28); --net-cursor: rgba(60,130,255,0.40); }
html[data-theme="light-blue"]   { --accent: #005fdb; --net-node: rgba(0,95,219,0.55); --net-link: rgba(0,95,219,0.28); --net-cursor: rgba(0,95,219,0.40); }
html[data-theme="light-pink"]   { --accent: #d83c8a; --net-node: rgba(216,60,138,0.55); --net-link: rgba(216,60,138,0.28); --net-cursor: rgba(216,60,138,0.40); }
html[data-theme="light-orange"] { --accent: #e97618; --net-node: rgba(233,118,24,0.55); --net-link: rgba(233,118,24,0.28); --net-cursor: rgba(233,118,24,0.40); }
html[data-theme="light-purple"] { --accent: #7038e3; --net-node: rgba(112,56,227,0.55); --net-link: rgba(112,56,227,0.28); --net-cursor: rgba(112,56,227,0.40); }
html[data-theme="light-magenta"]{ --accent: #c20065; --net-node: rgba(194,0,101,0.55); --net-link: rgba(194,0,101,0.28); --net-cursor: rgba(194,0,101,0.40); }
/* Dark base */
html[data-theme^="dark"] { --bg: #000; --text: #f3f3f3; --muted: #c9c9c9; --glass-bg: rgba(255,255,255,0.08); --glass-border: rgba(255,255,255,0.18); --btn-bg: rgba(255,255,255,0.06); --btn-inset: rgba(0,0,0,0.25); --btn-shadow: rgba(0,0,0,0.35); --eq: #47d16a; --danger: #ff6363; --shadow: 0 10px 30px rgba(0,0,0,0.45); }
html[data-theme="dark"]        { --accent: rgba(255,255,255,0.06); --net-node: rgba(255,255,255,0.55); --net-link: rgba(200,200,200,0.28); --net-cursor: rgba(220,220,220,0.40); }
html[data-theme="dark-blue"]   { --accent: #7aa2ff; --net-node: rgba(255,255,255,0.55); --net-link: rgba(160,190,255,0.30); --net-cursor: rgba(120,190,255,0.45); }
html[data-theme="dark-pink"]   { --accent: #ff6bb3; --net-node: rgba(255,230,245,0.70); --net-link: rgba(255,140,200,0.32); --net-cursor: rgba(255,120,200,0.45); }
html[data-theme="dark-orange"] { --accent: #ff9a3c; --net-node: rgba(255,240,220,0.70); --net-link: rgba(255,180,120,0.32); --net-cursor: rgba(255,160,110,0.45); }
html[data-theme="dark-purple"] { --accent: #8b5cf6; --net-node: rgba(240,230,255,0.70); --net-link: rgba(170,140,255,0.32); --net-cursor: rgba(150,120,255,0.45); }
html[data-theme="dark-magenta"]{ --accent: #E20074; --net-node: rgba(255,220,240,0.70); --net-link: rgba(226,0,116,0.30); --net-cursor: rgba(226,0,116,0.45); }

/* ---------- Page & Canvas ---------- */
#netCanvas{ position: fixed; inset: 0; width: 100%; height: 100%; display: block; pointer-events: none; z-index: 0; }
.theme-controls{ position: fixed; top: 14px; right: 14px; z-index: 10; display: flex; gap: 10px; align-items: center; }
.theme-toggle{ height: 40px; min-width: 40px; padding: 8px 12px; border: 1px solid var(--glass-border); border-radius: 12px; background: var(--glass-bg); color: var(--text); box-shadow: var(--shadow); cursor: pointer; backdrop-filter: blur(10px) saturate(120%); transition: transform 0.2s ease; }
.theme-toggle:hover { transform: translateY(-1px); }
.accent-wrap{ display: inline-flex; align-items: center; gap: 8px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 6px 10px; box-shadow: var(--shadow); backdrop-filter: blur(10px) saturate(120%); }
.accent-label{ font-size: 12px; color: var(--muted); }
.select-shell{ position: relative; display: inline-flex; align-items: center; gap: 8px; }
.accent-dot{ width: 10px; height: 10px; border-radius: 999px; background: var(--accent); box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent); transition: background-color 0.4s ease; }
.accent-select{ appearance: none; font-size: 14px; color: var(--text); background: color-mix(in oklab, var(--bg) 70%, white 30%); border: 1px solid var(--glass-border); padding: 8px 28px 8px 10px; border-radius: 10px; outline: none; cursor: pointer; min-width: 160px; }
.accent-select option{ background: var(--bg); color: var(--text); }
.chevron{ position: absolute; right: 8px; pointer-events: none; color: var(--muted); font-size: 12px; }

/* ---------- Calculator ---------- */
.wrap{ position: relative; z-index: 2; min-height: 100%; display: grid; place-items: center; padding: 24px; }
.calculator{ width: min(92vw, 400px); padding: 18px; border-radius: 18px; background: var(--glass-bg); backdrop-filter: blur(14px) saturate(120%); border: 1px solid var(--glass-border); box-shadow: var(--shadow); transition: background-color 0.4s ease, border-color 0.4s ease; }

/* Display & History */
.display-container{ position: relative; display: flex; align-items: center; }
.display{ width: 100%; height: 64px; font-size: 32px; font-family: 'Roboto Mono', monospace; text-align: right; color: var(--text); background: color-mix(in oklab, var(--bg) 70%, white 30%); border: 1px solid rgba(0,0,0,0.12); border-radius: 12px; padding: 10px 45px 10px 12px; margin-bottom: 14px; transition: font-size 0.2s ease; }
.display.font-medium { font-size: 26px; }
.display.font-small { font-size: 20px; }
.history-toggle { position: absolute; right: 8px; top: 18px; height: 30px; width: 30px; border: none; background: transparent; color: var(--muted); font-size: 20px; cursor: pointer; opacity: 0.6; transition: opacity 0.2s ease; }
.history-toggle:hover { opacity: 1; }
.history-panel { max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.1); border-radius: 8px; margin-bottom: 14px; padding: 8px; }
.history-panel ul { list-style: none; margin: 0; padding: 0; text-align: right; }
.history-panel li { padding: 4px 8px; border-radius: 4px; cursor: pointer; }
.history-panel li:hover { background: rgba(0,0,0,0.1); }
.history-panel .expr { font-size: 12px; color: var(--muted); }
.history-panel .res { font-size: 16px; font-weight: 500; color: var(--text); }

/* Buttons grid */
.buttons{ display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
.btn{ height: 48px; border: none; border-radius: 12px; font-size: 18px; color: var(--text); background: var(--btn-bg); cursor: pointer; box-shadow: 0 2px 8px var(--btn-inset) inset, 0 8px 20px var(--btn-shadow); transition: transform 0.1s ease, filter 0.1s ease; user-select: none; }
.btn:hover{ transform: translateY(-1px); }
.btn:active{ transform: translateY(0) scale(0.98); filter: brightness(0.9); }
.btn.btn-span-4 { grid-column: span 4; } /* ** FIX: New class for full-width button ** */
.btn-op{ background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 35%, transparent), color-mix(in oklab, var(--accent) 12%, transparent)); border: 1px solid color-mix(in oklab, var(--accent) 35%, transparent); }
.btn-eq{ background: linear-gradient(180deg, color-mix(in oklab, var(--eq) 38%, transparent), color-mix(in oklab, var(--eq) 16%, transparent)); border: 1px solid color-mix(in oklab, var(--eq) 40%, transparent); }
.btn-danger{ background: linear-gradient(180deg, color-mix(in oklab, var(--danger) 38%, transparent), color-mix(in oklab, var(--danger) 16%, transparent)); border: 1px solid color-mix(in oklab, var(--danger) 40%, transparent); }
.btn-mem { font-size: 16px; background: color-mix(in oklab, var(--muted) 20%, transparent); border: 1px solid color-mix(in oklab, var(--muted) 30%, transparent); }

@media (max-width: 420px){
  .btn{ height: 54px; font-size: 19px; }
  .display{ height: 68px; font-size: 34px; }
}